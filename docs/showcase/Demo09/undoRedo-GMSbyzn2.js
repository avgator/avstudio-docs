import{r as a,I as R,_ as d,g as y,f as n,A as I,z as k,j as e,a1 as l,B as i,N as E,y as F}from"./main-C9kTvUvK.js";import{R as H}from"./mainLayout-BQrZppkX.js";import"./details-CQoO5yCc.js";import"./Styles-B6kWeBqL.js";import"./index-DimBv2aS.js";import"./formItemPropsWrapper-ChMcIfaN.js";import"./renderActionTag-C_HVBKU8.js";import"./moment-G82_0lEo.js";import"./modificatorAPI-Clnut5Hb.js";import"./index-CCUbw95p.js";import"./pageAPI-4o2eRx6B.js";import"./SettingOutlined-CxBXSFIm.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},B=function(r,c){return a.createElement(R,d(d({},r),{},{ref:c,icon:K}))},w=a.forwardRef(B),D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},A=function(r,c){return a.createElement(R,d(d({},r),{},{ref:c,icon:D}))},$=a.forwardRef(A);const J=()=>{const{pageId:s}=y(),{projectId:r}=y(),[c,v]=a.useState(!1),{workingProject:u}=n(),g=n(o=>o.currentProjectHash),x=n(o=>o.savedProjectHash),{pastPatches:P,futurePatches:b,undo:f,redo:h,fetchAndFill:S}=n.getState(),p=P.length>0,m=b.length>0,z=g===x,j=a.useCallback(()=>{u&&(v(!0),I({projectData:u}).then(()=>{k.success("Project saved successfully")}).catch(o=>{console.error(o),k.error("Error while saving project")}).finally(()=>{v(!1)}))},[u]);function C(){r&&E({icon:e.jsx(F,{}),title:"Revert all project changes",content:"All unsaved changes made for this project will be lost. Are you sure you want to proceed?",okButtonProps:{danger:!0},okText:"Proceed",cancelText:"Cancel",onOk:()=>{S(r)},onCancel:()=>{console.info("Clear process aborted.")}})}return a.useEffect(()=>{const o=t=>{if((t.metaKey||t.ctrlKey)&&t.key==="s"&&(t.preventDefault(),j()),(t.metaKey||t.ctrlKey)&&t.shiftKey&&t.key==="z"&&m){t.preventDefault(),h();return}(t.metaKey||t.ctrlKey)&&t.key==="z"&&p&&(t.preventDefault(),f())};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[m,p,j,h,f]),e.jsxs(e.Fragment,{children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(l,{title:"Undo [ctrl/cmd + z]",children:e.jsx(i,{onClick:()=>f(),disabled:!p,icon:e.jsx(w,{})})}),e.jsx(l,{title:"Redo [ctrl/cmd + shift + z]",children:e.jsx(i,{onClick:()=>h(),disabled:!m,icon:e.jsx(w,{style:{transform:"scaleX(-1)"}})})})]}),!s&&r&&e.jsx(l,{title:"Revert all project changes & clear history",children:e.jsx(i,{danger:!0,disabled:z,onClick:()=>C(),icon:e.jsx(H,{})})}),e.jsx(l,{placement:"left",title:"Save project [ctrl/cmd + s]",children:e.jsx(i,{icon:e.jsx($,{}),loading:c,disabled:g===x||c,onClick:()=>{j()},type:"primary",children:"Save project"})})]})};export{J as default};
