import{u as T,f as D,g as N,r as f,j as e,cA as y,cJ as h,bW as A,ar as L,ax as B,a3 as P,Z as M,z as R,bQ as V,B as m}from"./main-C9kTvUvK.js";import{a as z,h as x,P as F,u as W}from"./pageAPI-4o2eRx6B.js";import{E as O}from"./EditableCell-DIG1vBc-.js";import{d as U}from"./deletePage-Br-nFKP3.js";import{T as Y}from"./tableFieldSearchInput-N9HEsIiN.js";import{R as _}from"./DiffOutlined-BWVCEeCe.js";import"./index-DimBv2aS.js";const{Title:$}=V,te=()=>{const p=T(),d=D(a=>a.workingProject),{projectId:l}=N(),[g,w]=f.useState(),C=[{title:e.jsx(Y,{value:g,setValue:w}),dataIndex:"name",sorter:(a,u)=>{const o=a.name.props.initialValue.toLowerCase(),n=u.name.props.initialValue.toLowerCase();return o<n?-1:o>n?1:0},defaultSortOrder:"ascend"},{title:e.jsx(e.Fragment,{children:"Design paradigm"}),dataIndex:"layoutMode"},{title:"Updated",dataIndex:"updated",sorter:(a,u)=>{const o=h(a.updated),n=h(u.updated);return o.isBefore(n)?-1:o.isAfter(n)?1:0},render:a=>e.jsx(e.Fragment,{children:h(a).format("MMM D, YYYY, h:mm A")})},y.EXPAND_COLUMN,{title:"Where Used",dataIndex:"used"},{title:"Actions",dataIndex:"actions",width:100}],{setNewPageModalVisible:S}=A(),[j,v]=f.useState(null);f.useEffect(()=>{let a=d?.attributes.pages.data?.filter(r=>r.attributes.isSubpage)||[];const u=d?.attributes.pages.data?.filter(r=>!r.attributes.isSubpage)||[];function o(r){const t=[];return[...u||[]].forEach((i,b)=>{i.attributes.containers?.forEach((k,E)=>{k.elements.filter(c=>c.type==="subpage").some(c=>c.subpageId===r)&&t.push(e.jsx(m,{onClick:c=>x({pageId:i.id,navigate:p,evt:c,projectId:l}),type:"dashed",size:"small",children:i.attributes.name},i.id+"_source_"+b+E))})}),t}function n(r){return!!a.find(s=>s.id===r)?.attributes.containers?.some(s=>s.elements.some(i=>i.type==="subpage"||i.type==="subpageList"))}if(a){g&&(a=a.filter(t=>{const s=t.attributes.name;if(!s)return!1;const i=s.trim().toLowerCase(),b=g.trim().toLowerCase();return i.includes(b)}));const r=[];for(const t of a)r.push({pageID:t.id,key:`subpage_${t.id}`,name:e.jsx(O,{style:{whiteSpace:"nowrap"},onChange:s=>s&&l&&W({pageId:t.id,inputData:{name:s}}),initialValue:t.attributes.name,value:t.attributes.name,validators:[s=>M({input:s,searchArray:a||[],searchKey:["attributes","name"]}).catch(i=>(R.error(i.message),Promise.reject()))]}),layoutMode:e.jsx(P,{icon:e.jsx(F,{style:{height:"auto",minWidth:"1em",margin:"0 3px -1px 0"},isStatic:t.attributes?.isStatic}),children:t.attributes?.isStatic?"adaptive":"responsive"}),updated:t.attributes.updatedAt,used:e.jsx("div",{style:{display:"flex",gap:5,flexWrap:"wrap"},children:o(t.id)}),nestedSubs:n(t.id),actions:e.jsxs(L.Button,{onClick:s=>x({pageId:t.id,navigate:p,evt:s,projectId:l}),menu:{items:[{key:"clonePage",icon:e.jsx(_,{}),label:"Clone SubPage",onClick:()=>l&&z({pageCloneData:t})},{key:"remove",danger:!0,icon:e.jsx(B,{}),label:"Delete SubPage",onClick:()=>l&&U({pageId:t.id,projectId:l,isSubpage:t.attributes.isSubpage,name:t.attributes.name})}]},children:[e.jsx("svg",{style:{marginRight:3,marginBottom:-2},xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M6 2c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-1.9l10-10V8l-6-6zm7 1.5L18.5 9H13zm7.1 9.5c-.1 0-.3.1-.4.2l-1 1l2.1 2.1l1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-2 1.8L12 20.9V23h2.1l6.1-6.1z"})}),"Open in Editor"]})});v(r)}},[p,l,g,d]);function I(a){const u=d?.attributes.pages.data.find(n=>n.id===a);if(!u)return null;const o=[];for(const n of u.attributes.containers||[])for(const r of n.elements)(r.type==="subpage"||r.type==="subpageList")&&o.push(r.subpageId);return e.jsx("div",{style:{display:"flex",gap:5,marginTop:10,flexWrap:"wrap"},children:o.map(n=>{const r=d?.attributes.pages.data.find(s=>s.id===n)?.attributes.name,t=!r;return e.jsx(m,{onClick:s=>!t&&x({pageId:n,navigate:p,evt:s,projectId:l}),type:"dashed",size:"small",danger:t,children:r||"Deleted"},n)})})}return e.jsxs(e.Fragment,{children:[e.jsx($,{id:"SubPages",style:{margin:"15px 0"},level:5,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["SubPages",e.jsx(m,{onClick:()=>S("subpage"),children:"Create New SubPage"})]})}),j?e.jsxs(e.Fragment,{children:[e.jsx(y,{expandable:{expandedRowRender:a=>e.jsxs(e.Fragment,{children:[e.jsx(P,{color:"geekblue",children:"1st level nested subpages"}),I(a.pageID)]}),rowExpandable:a=>a.nestedSubs},showSorterTooltip:!1,columns:C,dataSource:j,pagination:!1}),e.jsx(m,{style:{marginTop:15},type:"primary",onClick:()=>S("subpage"),children:"Create New SubPage"})]}):null]})};export{te as default};
