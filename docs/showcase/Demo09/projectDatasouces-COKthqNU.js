import{dP as me,r as o,C as L,c as D,a as x,c0 as C,c5 as J,dQ as te,c7 as fe,cg as pe,g as ve,f as ye,bW as be,z as X,j as f,ar as Ce,N as ge,dR as xe,ax as he,bQ as Ne,B as _,cA as Se,K as we,a9 as Pe,a7 as je}from"./main-C9kTvUvK.js";import{E as Ee}from"./EditableCell-DIG1vBc-.js";import{h as De}from"./moment-G82_0lEo.js";import{T as ke}from"./tableFieldSearchInput-N9HEsIiN.js";import{R as Re}from"./DiffOutlined-BWVCEeCe.js";import{P as $e}from"./index-CCUbw95p.js";import{R as Te}from"./PictureOutlined-yz_o64sC.js";import"./index-DimBv2aS.js";function A(a){return me.includes(a)}var Oe=function(e){var l=e.className,r=e.prefixCls,t=e.style,c=e.color,m=e.children,d=e.text,y=e.placement,g=y===void 0?"end":y,N=o.useContext(L),n=N.getPrefixCls,i=N.direction,u=n("ribbon",r),s=A(c),p=D(u,"".concat(u,"-placement-").concat(g),x(x({},"".concat(u,"-rtl"),i==="rtl"),"".concat(u,"-color-").concat(c),s),l),v={},h={};return c&&!s&&(v.background=c,h.color=c),o.createElement("div",{className:"".concat(u,"-wrapper")},m,o.createElement("div",{className:p,style:C(C({},v),t)},o.createElement("span",{className:"".concat(u,"-text")},d),o.createElement("div",{className:"".concat(u,"-corner"),style:h})))};function ee(a){var e=a.prefixCls,l=a.value,r=a.current,t=a.offset,c=t===void 0?0:t,m;return c&&(m={position:"absolute",top:"".concat(c,"00%"),left:0}),o.createElement("span",{style:m,className:D("".concat(e,"-only-unit"),{current:r})},l)}function Ie(a,e,l){for(var r=a,t=0;(r+10)%10!==e;)r+=l,t+=l;return t}function Ae(a){var e=a.prefixCls,l=a.count,r=a.value,t=Number(r),c=Math.abs(l),m=o.useState(t),d=J(m,2),y=d[0],g=d[1],N=o.useState(c),n=J(N,2),i=n[0],u=n[1],s=function(){g(t),u(c)};o.useEffect(function(){var P=setTimeout(function(){s()},1e3);return function(){clearTimeout(P)}},[t]);var p,v;if(y===t||Number.isNaN(t)||Number.isNaN(y))p=[o.createElement(ee,C({},a,{key:t,current:!0}))],v={transition:"none"};else{p=[];for(var h=t+10,w=[],S=t;S<=h;S+=1)w.push(S);var E=w.findIndex(function(P){return P%10===y});p=w.map(function(P,O){var z=P%10;return o.createElement(ee,C({},a,{key:P,value:z,offset:O-E,current:O===E}))});var T=i<c?1:-1;v={transform:"translateY(".concat(-Ie(y,t,T),"00%)")}}return o.createElement("span",{className:"".concat(e,"-only"),style:v,onTransitionEnd:s},p)}var ze=function(a,e){var l={};for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&e.indexOf(r)<0&&(l[r]=a[r]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,r=Object.getOwnPropertySymbols(a);t<r.length;t++)e.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(a,r[t])&&(l[r[t]]=a[r[t]]);return l},Me=function(e){var l=e.prefixCls,r=e.count,t=e.className,c=e.motionClassName,m=e.style,d=e.title,y=e.show,g=e.component,N=g===void 0?"sup":g,n=e.children,i=ze(e,["prefixCls","count","className","motionClassName","style","title","show","component","children"]),u=o.useContext(L),s=u.getPrefixCls,p=s("scroll-number",l),v=C(C({},i),{"data-show":y,style:m,className:D(p,t,c),title:d}),h=r;if(r&&Number(r)%1===0){var w=String(r).split("");h=w.map(function(S,E){return o.createElement(Ae,{prefixCls:p,count:Number(r),value:S,key:w.length-E})})}return m&&m.borderColor&&(v.style=C(C({},m),{boxShadow:"0 0 0 1px ".concat(m.borderColor," inset")})),n?te(n,function(S){return{className:D("".concat(p,"-custom-component"),S?.className,c)}}):o.createElement(N,v,h)},Be=function(a,e){var l={};for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&e.indexOf(r)<0&&(l[r]=a[r]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,r=Object.getOwnPropertySymbols(a);t<r.length;t++)e.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(a,r[t])&&(l[r[t]]=a[r[t]]);return l},re=function(e){var l=e.prefixCls,r=e.scrollNumberPrefixCls,t=e.children,c=e.status,m=e.text,d=e.color,y=e.count,g=y===void 0?null:y,N=e.overflowCount,n=N===void 0?99:N,i=e.dot,u=i===void 0?!1:i,s=e.size,p=s===void 0?"default":s,v=e.title,h=e.offset,w=e.style,S=e.className,E=e.showZero,T=E===void 0?!1:E,P=Be(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","showZero"]),O=o.useContext(L),z=O.getPrefixCls,U=O.direction,b=z("badge",l),Y=g>n?"".concat(n,"+"):g,M=Y==="0"||Y===0,ae=g===null||M&&!T,Z=(c!=null||d!=null)&&ae,I=u&&!M,k=I?"":Y,R=o.useMemo(function(){var j=k==null||k==="";return(j||M&&!T)&&!I},[k,M,T,I]),Q=o.useRef(g);R||(Q.current=g);var $=Q.current,W=o.useRef(k);R||(W.current=k);var F=W.current,H=o.useRef(I);R||(H.current=I);var B=o.useMemo(function(){if(!h)return C({},w);var j={marginTop:h[1]};return U==="rtl"?j.left=parseInt(h[0],10):j.right=-parseInt(h[0],10),C(C({},j),w)},[U,h,w]),oe=v??(typeof $=="string"||typeof $=="number"?$:void 0),ne=R||!m?null:o.createElement("span",{className:"".concat(b,"-status-text")},m),se=!$||fe($)!=="object"?void 0:te($,function(j){return{style:C(C({},B),j.style)}}),ce=D(x(x(x({},"".concat(b,"-status-dot"),Z),"".concat(b,"-status-").concat(c),!!c),"".concat(b,"-status-").concat(d),A(d))),K={};d&&!A(d)&&(K.background=d);var G=D(b,x(x(x({},"".concat(b,"-status"),Z),"".concat(b,"-not-a-wrapper"),!t),"".concat(b,"-rtl"),U==="rtl"),S);if(!t&&Z){var le=B.color;return o.createElement("span",C({},P,{className:G,style:B}),o.createElement("span",{className:ce,style:K}),m&&o.createElement("span",{style:{color:le},className:"".concat(b,"-status-text")},m))}return o.createElement("span",C({},P,{className:G}),t,o.createElement(pe,{visible:!R,motionName:"".concat(b,"-zoom"),motionAppear:!1,motionDeadline:1e3},function(j){var ie=j.className,ue=z("scroll-number",r),q=H.current,de=D(x(x(x(x(x(x({},"".concat(b,"-dot"),q),"".concat(b,"-count"),!q),"".concat(b,"-count-sm"),p==="small"),"".concat(b,"-multiple-words"),!q&&F&&F.toString().length>1),"".concat(b,"-status-").concat(c),!!c),"".concat(b,"-status-").concat(d),A(d))),V=C({},B);return d&&!A(d)&&(V=V||{},V.background=d),o.createElement(Me,{prefixCls:ue,show:!R,motionClassName:ie,className:de,count:F,title:oe,style:V,key:"scrollNumber"},se)}),ne)};re.Ribbon=Oe;const{Title:Ve}=Ne,He=()=>{const{projectId:a}=ve(),e=ye(n=>n.workingProject),[l,r]=o.useState(),t=o.useMemo(()=>e?.attributes?.datasources?.data||[],[e]),{setNewDatasourceVisible:c}=be(),[m,d]=o.useState(),y=o.useCallback(n=>t?.some(i=>i.attributes.name===n)?(X.error("Datasource's name must be unique"),!1):!0,[t]);o.useEffect(()=>{function n(i,u){const s=v=>y(`${v}_clone`)?`${v}_clone`:s(`${v}_clone`);if(!t)return null;const p={name:s(u),production:t[i].attributes.production,uid:we()};a&&Pe(a,p)}if(a)if(t&&Array.isArray(t)){const i=[];(l?t.filter(s=>s.attributes.name.toLowerCase().includes(l.toLowerCase())):t).forEach((s,p)=>{i.push({key:`datasource_${s.id}`,order:p+1,name:s,updated:De(s.attributes.updatedAt).format("MMM Do YYYY, h:mm a")||"",storageType:f.jsx("div",{children:f.jsx(re,{status:s.attributes.production.storageType==="none"?"error":"success",text:s.attributes.production.storageType})}),datasourcesActions:f.jsx(Ce.Button,{onClick:()=>{c(s.id)},menu:{items:[{key:"copy",icon:f.jsx(Re,{}),label:"Clone datasource",onClick:()=>n(p,s.attributes.name)},{key:"delete",icon:f.jsx(he,{}),label:"Delete datasource",danger:!0,onClick:()=>ge({title:`Delete datasource ${s.attributes.name} ?`,content:`This will remove datasource ${s.attributes.name} and all it's assignments. This action can not be undone.`,okText:"Delete datasource",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>xe(s.id),onCancel:()=>console.log("cancel datasource delete")})}]},children:"Edit"})})}),d(i)}else d([])},[a,t,c,y,l]);async function g(n,i,u){if(n===i)return i;if(!y(n))return X.error("Datasource's name must be unique"),i;if(n&&a)return je({name:n},u)}const N=[{title:f.jsx(ke,{value:l,setValue:r}),dataIndex:"name",sorter:(n,i)=>{try{const u=n.name.attributes.name.toLowerCase(),s=i.name.attributes.name.toLowerCase();if(u<s)return-1;if(u>s)return 1}catch(u){console.log(u)}return 0},defaultSortOrder:"ascend",render:n=>f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[n.attributes.production.isImagePreloadSource?f.jsx($e,{placement:"topLeft",title:"Datasource for Image preloading",content:"URLs array will be used to preload & cache images",trigger:"hover",arrowPointAtCenter:!0,children:f.jsx(Te,{})}):null,f.jsx(Ee,{onChange:i=>g(i,n.attributes.name,n.id),initialValue:n.attributes.name,value:n.attributes.name})]})},{title:"Updated",dataIndex:"updated"},{title:"Source",dataIndex:"storageType"},{title:"Actions",width:"100px",dataIndex:"datasourcesActions"}];return f.jsxs(f.Fragment,{children:[f.jsx(Ve,{id:"Data sources",style:{margin:"15px 0"},level:5,children:f.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsxs("span",{children:["Data sources (",m?.length||0,")"]}),f.jsx(_,{onClick:()=>c(!0),children:"Add Datasource"})]})}),f.jsx(Se,{columns:N,dataSource:m,pagination:!1}),f.jsx(_,{style:{marginTop:15},type:"primary",onClick:()=>c(!0),children:"Add Datasource"},"submit")]})};export{He as default};
